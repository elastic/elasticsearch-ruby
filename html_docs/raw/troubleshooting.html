<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Troubleshooting | Elasticsearch Ruby Client | Elastic</title>
<meta class="elastic" name="content" content="Troubleshooting | Elasticsearch Ruby Client">

<link rel="home" href="index.html" title="Elasticsearch Ruby Client"/>
<link rel="up" href="index.html" title="Elasticsearch Ruby Client"/>
<link rel="prev" href="examples.html" title="Examples"/>
<link rel="next" href="client-helpers.html" title="Client helpers"/>
<meta class="elastic" name="product_version" content=""/>
<meta class="elastic" name="product_name" content=""/>
<meta class="elastic" name="website_area" content="documentation"/>
<meta name="DC.type" content="Learn/Docs/"/>
<meta name="DC.subject" content=""/>
<meta name="DC.identifier" content=""/>
</head>
<body>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="/guide/">Elastic Docs</a></span>
<span class="chevron-right">›</span><span class="breadcrumb-link"><a href="index.html">Elasticsearch Ruby Client</a></span>
</div>
<div class="navheader">
<span class="prev">
<a href="examples.html">« Examples</a>
</span>
<span class="next">
<a href="client-helpers.html">Client helpers »</a>
</span>
</div>
<div class="chapter">
<div class="titlepage"><div><div>
<h1 class="title"><a id="troubleshooting"></a>Troubleshooting<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-ruby/edit/master/docs/troubleshooting.asciidoc">edit</a></h1>
</div></div></div>
<p>Use the information in this section to troubleshoot common problems and find
answers for frequently asked questions.</p>
<h3><a id="ruby-ts-logging"></a>Logging<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-ruby/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
<p>The client provides several options for logging that can help when things go
wrong. Check out the extensive documentation on <a class="xref" href="advanced-config.html#logging" title="Logging">Logging</a>.</p>
<p>If you are having trouble sending a request to Elasticsearch with the client, we suggest
enabling <code class="literal">tracing</code> on the client and testing the cURL command that appears in
your terminal:</p>
<div class="pre_wrapper lang-rb">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-rb">client = Elasticsearch::Client.new(trace: true)
client.info
curl -X GET -H 'x-elastic-client-meta: es=8.9.0,rb=3.2.2,t=8.2.1,fd=2.7.4,nh=0.3.2, User-Agent: elastic-t
ransport-ruby/8.2.1 (RUBY_VERSION: 3.2.2; linux x86_64; Faraday v2.7.4), Content-Type: application/json' 'http://localhost:9200//?pretty'</pre>
</div>
<p>Testing the cURL command can help find out if there&#8217;s a connection issue or if
the issue is in the client code.</p>
<h3><a id="ruby-ts-connection"></a>Troubleshooting connection issues<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-ruby/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
<p>When working with multiple hosts, you might want to enable the
<code class="literal">retry_on_failure</code> or <code class="literal">retry_on_status</code> options to perform a failed request on
another node (refer to <a class="xref" href="advanced-config.html#retry-failures" title="Retrying on Failures">Retrying on Failures</a>).</p>
<p>For optimal performance, use a HTTP library which supports persistent
("keep-alive") connections, such as <a href="https://github.com/toland/patron" class="ulink" target="_top">patron</a> or
<a href="https://github.com/typhoeus/typhoeus" class="ulink" target="_top">Typhoeus</a>. Require the library
(<code class="literal">require 'patron'</code>) in your code for Faraday 1.x or the adapter
(<code class="literal">require 'faraday/patron'</code>) for Faraday 2.x, and it will be automatically used.</p>
<h3><a id="ruby-ts-adapter"></a>Adapter is not registered on Faraday<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-ruby/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
<p>If you see a message like:</p>
<pre class="screen">:adapter is not registered on Faraday::Adapter (Faraday::Error)</pre>
<p>Then you might need to include the adapter library in your Gemfile and require
it. You might get this error when migrating from Faraday v1 to Faraday v2. The
main change when using Faraday v2 is all adapters, except for the default
<code class="literal">net_http</code> one, have been moved out into separate gems. This means if you&#8217;re not
using the default adapter and you migrate to Faraday v2, you&#8217;ll need to add the
adapter gems to your Gemfile.</p>
<p>These are the gems required for the different adapters with Faraday 2, instead
of the libraries on which they were based:</p>
<div class="pre_wrapper lang-ruby">
<div class="console_code_copy" title="Copy to clipboard"></div>
<pre class="programlisting prettyprint lang-ruby"># HTTPCLient
gem 'faraday-httpclient'

# NetHTTPPersistent
gem 'faraday-net_http_persistent'

# Patron
gem 'faraday-patron'

# Typhoeus
gem 'faraday-typhoeus'</pre>
</div>
<p>Migrating to Faraday 2 solves the issue as long as the adapter is included
(unless you&#8217;re using the default one <code class="literal">net-http</code>). Alternatively, you can lock
the version of Faraday in your project to 1.x:
<code class="literal">gem 'faraday', '~&gt; 1'</code></p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>Migrating to Faraday v2 requires at least Ruby <code class="literal">2.6</code>. Faraday v1
requires <code class="literal">2.4</code>.</p>
</div>
</div>
<h3><a id="_more_help"></a>More Help<a class="edit_me" rel="nofollow" title="Edit this page on GitHub" href="https://github.com/elastic/elasticsearch-ruby/edit/master/docs/troubleshooting.asciidoc">edit</a></h3>
<p>If you need more help, visit the
<a href="https://discuss.elastic.co/" class="ulink" target="_top">Elastic community forums</a> and get answers from the
experts in the community, including people from Elastic.</p>
<p>If you find a bug, have feedback, or find any other issue using the client,
<a href="https://github.com/elastic/elasticsearch-ruby/issues/new/choose" class="ulink" target="_top">submit an issue</a>
on GitHub.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="examples.html">« Examples</a>
</span>
<span class="next">
<a href="client-helpers.html">Client helpers »</a>
</span>
</div>
</div>
</body>
</html>
